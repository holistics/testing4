Dataset american_housing_data_chinh_test {
  label: 'American Housing Data (Chinh Test)'
  description: 'To reproduce the use case of telegraph.io'
  data_source_name: 'demodb'
  owner: 'chinh.dm@holistics.io'

  models: [
    zipcode_data_american_housing_data,
    param_model,
  ]
  relationships: [
  ]

  metric total_price {
    label: 'Total Price'
    type: 'number'
    definition: @aql sum(zipcode_data_american_housing_data.price) ;;
  }

  metric divider {
    label: 'Dynamic Divider'
    type: 'text'
    definition: @aql
      case(
        when: total_price is null, then: 'IGNORE',
        when: total_price >= (param_model.param_slider | first()), then: 'HIGH',
        else: 'LOW'
      )
     ;;
  }

  dimension divider_legend {
    model: zipcode_data_american_housing_data
    label: 'Dynamic Divider Legend'
    type: 'text'
    definition: @aql dimensionalize(divider, zipcode_data_american_housing_data.longitude, zipcode_data_american_housing_data.latitude) ;;
  }
}
